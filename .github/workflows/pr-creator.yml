
name: Create PR from Dev to Default Branch
on:
  workflow_dispatch:
  schedule:
    - cron: '30 18 * * 6'  # Runs every Saturday at midnight IST (adjust as needed)

jobs:
  create-pr:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write

    steps:
      - name: Check for changes
        run: |
          git fetch --prune --unshallow
          CHANGED_FILES=$(git diff --name-only origin/main...dev)
          if [[ -z "$CHANGED_FILES" ]]; then
            echo "No changes detected. Skipping PR creation."
            exit 0
          fi
      - name: Create pull request
        uses: actions/github-script@v5
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            github.rest.pulls.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              head: 'dev',
              base: 'main',
              title: 'Automatic PR from Dev to Main ({{ github.event.head_commit.message }})',
              body: 'This PR was automatically created by the GitHub Actions workflow on Friday night (IST) as there were changes in the Dev branch.'
            })
            console.log("Pull request created!")